(this["webpackJsonptelemetry-web"]=this["webpackJsonptelemetry-web"]||[]).push([[0],{159:function(e,t,a){e.exports=a(319)},304:function(e,t,a){},317:function(e,t,a){},319:function(e,t,a){"use strict";a.r(t);var n=a(34),r=a(36),o=a(35),s=a(37),i=a(38),l=a.n(i),c=function(e,t,a){return{datasets:[{spanGaps:!1,showLine:!0,label:e,yAxisID:t,fill:!0,lineTension:.1,backgroundColor:"rgba(75,192,192,0.4)",borderColor:"rgba(75,192,192,1)",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:"rgba(75,192,192,1)",pointBackgroundColor:"#fff",pointBorderWidth:1,pointHoverRadius:5,pointHoverBackgroundColor:"rgba(75,192,192,1)",pointHoverBorderColor:"rgba(220,220,220,1)",pointHoverBorderWidth:2,pointRadius:1,pointHitRadius:10,data:a}]}},d=a(1),p=a.n(d),u=a(140),m=function(e){function t(){var e,a;Object(n.a)(this,t);for(var s=arguments.length,i=new Array(s),l=0;l<s;l++)i[l]=arguments[l];return(a=Object(r.a)(this,(e=Object(o.a)(t)).call.apply(e,[this].concat(i)))).render=function(){return p.a.createElement("div",null,p.a.createElement(u.a,{data:a.props.data,options:a.props.options}))},a}return Object(s.a)(t,e),t}(p.a.Component),f=a(326),h=a(143),g=a(324),v=a(330),b=a(327),y=a(9),E=a(331),w=a(325),O=a(116),N=a(80),x=a(328),C=a(329),S=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(o.a)(t).call(this,e))).clearFeature=function(e){a.features[e].getSource().getFeatures().forEach((function(t){return a.features[e].getSource().removeFeature(t)}))},a.formatCoordinate=function(e){return y.d([e.lng,e.lat])},a.componentDidMount=function(){var e=new f.a({view:new h.a({center:a.formatCoordinate(k.map.defaults.center),zoom:k.map.defaults.zoom}),layers:[new v.a({source:new x.a})],target:"map"});a.setState({map:e,loaded:!0})},a.shouldComponentUpdate=function(e,t){return!a.props.data||(!e.data||a.props.data.length!==e.data.length||JSON.stringify(a.props.data)!==JSON.stringify(e.data))},a.componentWillUnmount=function(){a.features={},a.setState({map:null,loaded:!1})},a.centerMap=function(){a.props.data&&a.props.data.length>0&&a.state.map.getView().setCenter(a.formatCoordinate(a.props.data[a.props.data.length-1]))},a.drawLineOnMap=function(){if(a.props.data&&a.props.data.length>0){a.features.lines&&a.clearFeature("lines");var e=new g.a({geometry:new E.a(a.props.data.map((function(e){return a.formatCoordinate(e)}))),name:"lines"});a.features.lines=new b.a({source:new C.a({features:[e]})}),e.setStyle(new O.b({stroke:new N.a({width:4})})),a.state.map.addLayer(a.features.lines)}else a.clearFeature("lines")},a.drawMarkersOnMap=function(){if(a.props.data&&a.props.data.length>0){var e=new g.a({geometry:new w.a(a.props.data.map((function(e){return a.formatCoordinate(e)}))),name:"markers"});a.features.markers=new b.a({source:new C.a({features:[e]})}),a.state.map.addLayer(a.features.markers)}else a.clearFeature("markers")},a.render=function(){return a.state.loaded&&(a.drawLineOnMap(),a.drawMarkersOnMap(),a.centerMap()),p.a.createElement("div",{id:"map"})},a.features={},a.state={map:null,loaded:!1},a}return Object(s.a)(t,e),t}(p.a.Component),k={datastore:{projectId:"supermileage-telemetry-266511",getQueryUrl:function(){return"https://datastore.googleapis.com/v1/projects/"+this.projectId+":runQuery?alt=json"},generatePayload:function(e,t){return{method:"POST",headers:{Authorization:"Bearer "+e,Accept:"application/json","Content-Type":"application/json"},body:t}},datasets:{Urban:[{label:"Temperature",id:"Temperature",handler:function(e,t){var a=t.entity.properties.data.stringValue.split(" "),n={};n.y=parseFloat(a[0]),n.x=l()(t.entity.properties.recorded_at.stringValue),e.length>0&&n.x.unix()-l()(e[e.length-1].x).unix()>600&&e.push({y:NaN,x:n.x}),e.push(n)},parser:function(e,t,a){return c(e,t,a)},element:function(e){return p.a.createElement("div",{className:"column is-half-desktop",key:this.id},p.a.createElement("div",{className:"box"},p.a.createElement(m,{data:e||{},options:this.options})))},options:{animation:{duration:500},scales:{xAxes:[{gridLines:{display:!1},type:"time",distribution:"linear",scaleLabel:{display:!0,labelString:"Time"}}],yAxes:[{id:"Temperature",position:"left",gridLines:{display:!1},scaleLabel:{display:!0,labelString:"Temperature (C)"}}]}}},{label:"Power",id:"Power",handler:function(e,t){var a={};a.y=parseFloat(t.entity.properties.data.stringValue),a.x=l()(t.entity.properties.recorded_at.stringValue),e.length>0&&a.x.unix()-l()(e[e.length-1].x).unix()>600&&e.push({y:NaN,x:a.x}),e.push(a)},parser:function(e,t,a){return c(e,t,a)},element:function(e){return p.a.createElement("div",{className:"column is-half-desktop",key:this.id},p.a.createElement("div",{className:"box"},p.a.createElement(m,{data:e||{},options:this.options})))},options:{animation:{duration:500},scales:{xAxes:[{gridLines:{display:!1},type:"time",distribution:"linear",scaleLabel:{display:!0,labelString:"Time"}}],yAxes:[{id:"Power",position:"left",gridLines:{display:!1},scaleLabel:{display:!0,labelString:"State of Charge (%)"}}]}}},{label:"Location",id:"Location",handler:function(e,t){var a=t.entity.properties.data.stringValue.split(","),n=parseInt(parseInt(a[3])/100)+parseFloat(parseFloat(a[3])%100)/60,r=parseInt(parseInt(a[5])/100)+parseFloat(parseFloat(a[5])%100)/60,o={lat:n="S"===a[4]?-n:n,lng:r="W"===a[6]?-r:r};e.push(o)},parser:function(e,t,a){return a},element:function(e){return p.a.createElement("div",{className:"column is-full",key:this.id},p.a.createElement("div",{className:"card"},p.a.createElement(S,{data:e||[]})))}}],Proto:[{label:"Speed",id:"PROTO-Speed",handler:function(e,t){var a=t.entity.properties.data.stringValue.split(","),n={};n.y=parseFloat(a[a.indexOf("K")-1]),n.x=l()(t.entity.properties.recorded_at.stringValue),e.length>0&&n.x.unix()-l()(e[e.length-1].x).unix()>600&&e.push({y:NaN,x:n.x}),e.push(n)},parser:function(e,t,a){return c(e,t,a)},element:function(e){return p.a.createElement("div",{className:"column",key:this.id},p.a.createElement("div",{className:"box"},p.a.createElement(m,{data:e||{},options:this.options})))},options:{animation:{duration:500},scales:{xAxes:[{gridLines:{display:!1},type:"time",distribution:"linear",scaleLabel:{display:!0,labelString:"Time"}}],yAxes:[{id:"PROTO-Speed",position:"left",gridLines:{display:!1},scaleLabel:{display:!0,labelString:"km/h"}}]}}},{label:"Location",id:"PROTO-Location",handler:function(e,t){var a=t.entity.properties.data.stringValue.split(","),n=parseInt(parseInt(a[3])/100)+parseFloat(parseFloat(a[3])%100)/60,r=parseInt(parseInt(a[5])/100)+parseFloat(parseFloat(a[5])%100)/60,o={lat:n="S"===a[4]?-n:n,lng:r="W"===a[6]?-r:r,timestamp:t.entity.properties.recorded_at.stringValue};e.push(o)},parser:function(e,t,a){return a},element:function(e){return p.a.createElement("div",{className:"column is-full",key:this.id},p.a.createElement("div",{className:"card"},p.a.createElement(S,{data:e||[]})))}}]}},oauth:{clientId:"929098184548-qq0n3oj40b7s2qbk8nmjm9cn5c6bs15l.apps.googleusercontent.com"},map:{defaults:{center:{lat:49.267941,lng:-123.24736},zoom:12}},refreshInterval:8e3},T=a(142),j=a.n(T),F=a(48),L=a.n(F),H=(a(303),function(e){function t(){var e,a;Object(n.a)(this,t);for(var s=arguments.length,i=new Array(s),l=0;l<s;l++)i[l]=arguments[l];return(a=Object(r.a)(this,(e=Object(o.a)(t)).call.apply(e,[this].concat(i)))).render=function(){return p.a.createElement("div",{className:"field"},p.a.createElement("input",{id:"switch",className:"switch is-medium",type:"checkbox",onChange:a.props.onChange,checked:a.props.defaultChecked}),p.a.createElement("label",{htmlFor:"switch"}))},a}return Object(s.a)(t,e),t}(p.a.Component)),A=function(e){function t(){var e,a;Object(n.a)(this,t);for(var s=arguments.length,i=new Array(s),l=0;l<s;l++)i[l]=arguments[l];return(a=Object(r.a)(this,(e=Object(o.a)(t)).call.apply(e,[this].concat(i)))).render=function(){return a.props.liveMode||a.props.updating?p.a.createElement("button",{className:"button is-info is-loading",onClick:a.props.getDataHandler,disabled:!0},"Update"):p.a.createElement("button",{className:"button is-info",onClick:a.props.getDataHandler},"Update")},a}return Object(s.a)(t,e),t}(p.a.Component),I=(a(304),a(115)),M=a.n(I),D=function(e){function t(){var e,a;Object(n.a)(this,t);for(var s=arguments.length,i=new Array(s),l=0;l<s;l++)i[l]=arguments[l];return(a=Object(r.a)(this,(e=Object(o.a)(t)).call.apply(e,[this].concat(i)))).render=function(){return p.a.createElement("div",{className:"columns"},p.a.createElement("div",{className:"column"},p.a.createElement(M.a,{className:"input",type:"date",onChange:a.props.onChangeStart,value:a.props.startTime})),p.a.createElement("div",{className:"column"},p.a.createElement(M.a,{className:"input",type:"date",onChange:a.props.onChangeEnd,inputProps:{disabled:null===a.props.endTime},value:null===a.props.endTime?"Current":a.props.endTime})))},a}return Object(s.a)(t,e),t}(p.a.Component),_=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(o.a)(t).call(this,e))).componentDidMount=function(){document.addEventListener("click",(function(e){e.target.matches(".dropdown-trigger *")||a.state.dropdownOpen&&a.setDropdownState(!1)}))},a.setDropdownState=function(e){a.setState({dropdownOpen:e})},a.startTimeChangeHandler=function(e){a.setState({startTime:e})},a.endTimeChangeHandler=function(e){a.setState({endTime:e})},a.liveUpdateHandler=function(e){e.target.checked?(a.setState({liveMode:!0,endTime:null}),a.intervalHandler()):(clearTimeout(a.timeout),a.setState({liveMode:!1}),a.endTimeChangeHandler(l()()))},a.intervalHandler=function(){return L.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.a.awrap(a.updateMetrics());case 2:a.state.liveMode&&(a.timeout=setTimeout(a.intervalHandler,k.refreshInterval));case 3:case"end":return e.stop()}}))},a.getDataHandler=function(e,t,n,r){var o,s,i;return L.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:return c=a.state.liveMode,d=a.state.startTime,p=a.state.endTime,u=n,o=c?{query:{filter:{compositeFilter:{filters:[{propertyFilter:{op:"GREATER_THAN_OR_EQUAL",property:{name:"recorded_at"},value:{stringValue:d.toISOString()}}},{propertyFilter:{op:"EQUAL",property:{name:"event"},value:{stringValue:u}}}],op:"AND"}},kind:[{name:"ParticleEvent"}],projection:[{property:{name:"data"}},{property:{name:"recorded_at"}}]}}:{query:{filter:{compositeFilter:{filters:[{propertyFilter:{op:"GREATER_THAN_OR_EQUAL",property:{name:"recorded_at"},value:{stringValue:d.toISOString()}}},{propertyFilter:{op:"LESS_THAN_OR_EQUAL",property:{name:"recorded_at"},value:{stringValue:p.toISOString()}}},{propertyFilter:{op:"EQUAL",property:{name:"event"},value:{stringValue:u}}}],op:"AND"}},kind:[{name:"ParticleEvent"}],projection:[{property:{name:"data"}},{property:{name:"recorded_at"}}]}},null!==e&&(o.query.startCursor=e),l.next=4,L.a.awrap(fetch(k.datastore.getQueryUrl(),k.datastore.generatePayload(a.props.token,JSON.stringify(o))));case 4:return s=l.sent,l.next=7,L.a.awrap(s.json());case 7:if(i=l.sent,l.prev=8,"entityResults"in i.batch&&i.batch.entityResults.forEach((function(e){r(t,e)})),"NOT_FINISHED"!==i.batch.moreResults){l.next=14;break}return l.next=13,L.a.awrap(a.getDataHandler(i.batch.endCursor,t,n,r));case 13:return l.abrupt("return",l.sent);case 14:l.next=19;break;case 16:l.prev=16,l.t0=l.catch(8),console.log(l.t0);case 19:return l.abrupt("return",t);case 20:case"end":return l.stop()}var c,d,p,u}),null,null,[[8,16]])},a.getData=function(){var e,t,n,r,o,s,i,l;return L.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:e={},t=!0,n=!1,r=void 0,c.prev=4,o=k.datastore.datasets[a.state.car][Symbol.iterator]();case 6:if(t=(s=o.next()).done){c.next=15;break}return i=s.value,c.next=10,L.a.awrap(a.getDataHandler(null,[],i.id,i.handler));case 10:l=c.sent,e[i.id]=i.parser(i.label,i.id,l);case 12:t=!0,c.next=6;break;case 15:c.next=21;break;case 17:c.prev=17,c.t0=c.catch(4),n=!0,r=c.t0;case 21:c.prev=21,c.prev=22,t||null==o.return||o.return();case 24:if(c.prev=24,!n){c.next=27;break}throw r;case 27:return c.finish(24);case 28:return c.finish(21);case 29:return c.abrupt("return",e);case 30:case"end":return c.stop()}}),null,null,[[4,17,21,29],[22,,24,28]])},a.updateMetrics=function(){var e;return L.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return a.setState({updating:!0}),t.next=3,L.a.awrap(a.getData());case 3:e=t.sent,a.setState({updating:!1,data:e});case 5:case"end":return t.stop()}}))},a.changeCar=function(e){e.target.id!==a.state.car&&a.setState({car:e.target.id,data:{}})},a.populateCars=function(){var e=[];for(var t in k.datastore.datasets)e.push(p.a.createElement("a",{className:"dropdown-item",id:t,key:t,onClick:a.changeCar},t));return e},a.render=function(){return p.a.createElement("div",null,p.a.createElement("div",{className:"container notification"},p.a.createElement("div",{className:"columns"},p.a.createElement("div",{className:"column is-narrow"},p.a.createElement(D,{startTime:a.state.startTime,endTime:a.state.endTime,onChangeStart:a.startTimeChangeHandler,onChangeEnd:a.endTimeChangeHandler})),p.a.createElement("div",{className:"column"},p.a.createElement("div",{className:"columns is-mobile is-vcentered is-multiline"},p.a.createElement("div",{className:"toggle column is-narrow"},p.a.createElement(H,{defaultChecked:a.state.liveMode,onChange:a.liveUpdateHandler})),p.a.createElement("div",{className:"column is-narrow"},p.a.createElement("div",{className:"dropdown"+(a.state.dropdownOpen?" is-active":"")},p.a.createElement("div",{className:"dropdown-trigger",onClick:function(){a.setDropdownState(!a.state.dropdownOpen)}},p.a.createElement("button",{className:"button",controls:"dropdown-menu"},p.a.createElement("span",null,a.state.car),p.a.createElement("span",{className:"icon is-small"},p.a.createElement("i",{className:"fas fa-angle-down"})))),p.a.createElement("div",{className:"dropdown-menu",id:"dropdown-menu",role:"menu"},p.a.createElement("div",{className:"dropdown-content"},a.populateCars())))),p.a.createElement("div",{className:"column is-narrow"},p.a.createElement(A,{liveMode:a.state.liveMode,getDataHandler:a.updateMetrics,updating:a.state.updating})))))),p.a.createElement("div",{className:"container"},p.a.createElement("div",{className:"columns is-desktop is-multiline"},k.datastore.datasets[a.state.car].map((function(e,t){return e.element(a.state.data[e.id])})))))},a.state={startTime:l()(),endTime:l()(),liveMode:!1,updating:!1,dropdownOpen:!1,data:{},car:"Urban"},a}return Object(s.a)(t,e),t}(p.a.Component),R=(a(317),a(318),function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(o.a)(t).call(this,e))).oauthSuccess=function(e){a.setState({loggedOn:!0,token:e.accessToken})},a.oauthFailure=function(e){console.log(e,"Oauth Failed.")},a.infoHide=function(){a.setState({infoOn:!1})},a.render=function(){var e=p.a.createElement("div",{className:"container"},p.a.createElement("div",{className:"notification is-info"},"Welcome! If it's your first time here, the toggle sets whether the data is updated live. Otherwise, you can grab specific data by selecting your time range, then pressing \"Update\". You may encounter errors if you're not authorized to access the datastore. You can close this message on the top right.",p.a.createElement("button",{onClick:a.infoHide,className:"delete"}))),t=p.a.createElement("div",{className:"container notification is-link floater"},"To get started, log in to generate an OAuth token.");return a.state.loggedOn?p.a.createElement("div",null,a.state.infoOn?e:void 0,p.a.createElement(_,{token:a.state.token})):p.a.createElement("div",null,t,p.a.createElement("div",{className:"login"},p.a.createElement(j.a,{clientId:k.oauth.clientId,scope:"profile email https://www.googleapis.com/auth/datastore",buttonText:"Login",onSuccess:a.oauthSuccess,onFailure:a.oauthFailure})))},a.state={infoOn:!0,loggedOn:!1,token:void 0},a}return Object(s.a)(t,e),t}(p.a.Component)),U=a(103);a.n(U).a.render(p.a.createElement(R,null),document.getElementById("root"))}},[[159,1,2]]]);
//# sourceMappingURL=main.f2083dc6.chunk.js.map