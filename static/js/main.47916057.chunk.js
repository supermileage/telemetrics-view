(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{239:function(e,t,a){},240:function(e,t,a){},241:function(e,t,a){},243:function(e,t,a){"use strict";a.r(t);var n=a(73),r=a(11),o=a.n(r),s=a(33),i=a(19),l=a(44),c=a(21),d=a(20),p=a(22),u=a(0),m=a.n(u),h=a(43),g=a.n(h),f=a(69),b=a(4),v=a.n(b),y=a(45),E=a(71),C=a.n(E),w=a(72),O=a.n(w),k={datasets:[{spanGaps:!1,showLine:!0,label:"Velocity",yAxisID:"Velocity",fill:!0,lineTension:.1,backgroundColor:"rgba(75,192,192,0.4)",borderColor:"rgba(75,192,192,1)",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:"rgba(75,192,192,1)",pointBackgroundColor:"#fff",pointBorderWidth:1,pointHoverRadius:5,pointHoverBackgroundColor:"rgba(75,192,192,1)",pointHoverBorderColor:"rgba(220,220,220,1)",pointHoverBorderWidth:2,pointRadius:1,pointHitRadius:10,data:[]},{spanGaps:!1,showLine:!0,label:"Power",yAxisID:"Power",fill:!0,lineTension:.1,backgroundColor:"rgba(192,86,75,0.4)",borderColor:"rgba(192,86,75,1)",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:"rgba(192,86,75,1)",pointBackgroundColor:"#fff",pointBorderWidth:1,pointHoverRadius:5,pointHoverBackgroundColor:"rgba(192,86,75,1)",pointHoverBorderColor:"rgba(220,220,220,1)",pointHoverBorderWidth:2,pointRadius:1,pointHitRadius:10,data:[]}]},S={animation:{duration:500},scales:{xAxes:[{gridLines:{display:!1},type:"time",distribution:"linear",scaleLabel:{display:!0,labelString:"Time"}}],yAxes:[{id:"Velocity",position:"left",gridLines:{display:!1},scaleLabel:{display:!0,labelString:"Velocity"}},{id:"Power",position:"right",gridLines:{display:!1},scaleLabel:{display:!0,labelString:"Power"}}]}},N=function(e,t){return e.current?{query:{filter:{compositeFilter:{filters:[{propertyFilter:{op:"GREATER_THAN_OR_EQUAL",property:{name:"published_at"},value:{stringValue:e.startTime.toISOString()}}},{propertyFilter:{op:"EQUAL",property:{name:"event"},value:{stringValue:t}}}],op:"AND"}},kind:[{name:"ParticleEvent"}],projection:[{property:{name:"data"}},{property:{name:"published_at"}}]}}:{query:{filter:{compositeFilter:{filters:[{propertyFilter:{op:"GREATER_THAN_OR_EQUAL",property:{name:"published_at"},value:{stringValue:e.startTime.toISOString()}}},{propertyFilter:{op:"LESS_THAN_OR_EQUAL",property:{name:"published_at"},value:{stringValue:e.endTime.toISOString()}}},{propertyFilter:{op:"EQUAL",property:{name:"event"},value:{stringValue:t}}}],op:"AND"}},kind:[{name:"ParticleEvent"}],projection:[{property:{name:"data"}},{property:{name:"published_at"}}]}}},j={Today:v()(),Yesterday:v()().subtract(1,"days")},T=(a(239),a(240),a(241),a(242),function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(c.a)(this,Object(d.a)(t).call(this,e))).handleChangeStart=function(e){a.setState({startTime:e})},a.handleChangeEnd=function(e){a.setState({endTime:e})},a.handleCurrent=function(e){e.target.checked?(a.setState({current:!0,endTime:null}),a.intervalHandler()):(clearTimeout(a.timeout),a.setState({current:!1}),a.handleChangeEnd(v()()))},a.intervalHandler=Object(s.a)(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getData();case 2:console.log("get data done, resetting"),a.state.current&&(a.timeout=setTimeout(a.intervalHandler,2e3));case 4:case"end":return e.stop()}},e,this)})),a.getDataHandler=function(){var e=Object(s.a)(o.a.mark(function e(t,n){var r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=N(a.state,t),null!==a.lastCursor&&(r.query.startCursor=a.lastCursor),e.next=4,fetch("https://datastore.googleapis.com/v1/projects/ubc-supermileage-telemetry-v2:runQuery?prettyPrint=true&alt=json",{method:"POST",headers:{Authorization:"Bearer "+a.token,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(r)}).then(function(e){return e.json().then(function(e){console.log(e);try{if("entityResults"in e.batch?(console.log(),null===a.lastCursor?a.vals=[]:a.vals=a.vals.slice(),e.batch.entityResults.forEach(function(e){if(0===n){var t={};t.y=parseFloat(e.entity.properties.data.stringValue),t.x=v()(e.entity.properties.published_at.stringValue),a.vals.length>0&&t.x.unix()-v()(a.vals[a.vals.length-1].x).unix()>600&&a.vals.push({y:NaN,x:t.x}),a.vals.push(t)}else{var r=e.entity.properties.data.stringValue.split(","),o=parseInt(parseInt(r[3])/100)+parseFloat(parseFloat(r[3])%100)/60,s=parseInt(parseInt(r[5])/100)+parseFloat(parseFloat(r[5])%100)/60;o="S"===r[4]?-o:o,s="W"===r[6]?-s:s;var i={};i.lat=o,i.lng=s,a.vals.push(i)}})):a.vals=[],"NOT_FINISHED"===e.batch.moreResults)return console.log("Not done"),a.lastCursor=e.batch.endCursor,a.getDataHandler(t,n)}catch(r){console.log(r)}return console.log("Done"),a.lastCursor=null,!0})});case 4:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}(),a.getData=Object(s.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.setState({updating:!0}),t=Object(n.a)(a.state.graph.datasets),null===a.chartRef||!0===a.chartRef.props.data.datasets[0]._meta[0].hidden){e.next=6;break}return e.next=5,a.getDataHandler("Velocity",0);case 5:t[0].data=a.vals;case 6:if(null===a.chartRef||!0===a.chartRef.props.data.datasets[1]._meta[0].hidden){e.next=10;break}return e.next=9,a.getDataHandler("Power",0);case 9:t[1].data=a.vals;case 10:return e.next=12,a.getDataHandler("Location",1);case 12:console.log(a.vals),a.setState({graph:{datasets:t},coordinates:a.vals.slice(),updating:!1});case 14:case"end":return e.stop()}},e,this)})),a.responseGoogle=function(e){a.setState({loggedIn:!0}),console.log(e),console.log("Success"),a.token=e.accessToken},a.responseFail=function(e){console.log(e),console.log("Failed")},a.buttonProvider=function(){return a.state.current?m.a.createElement("button",{className:"button is-rounded is-info is-small is-loading",onClick:a.getData,disabled:!0},"Update"):a.state.updating?m.a.createElement("button",{className:"button is-rounded is-info is-small is-loading",onClick:a.getData,disabled:!0},"Update"):m.a.createElement("button",{className:"button is-rounded is-info is-small",onClick:a.getData},"Update")},a.infoHide=function(){a.setState({infoOn:!1})},a.getChartRef=function(e){null===a.chartRef&&null!==e&&(a.chartRef=e)},a.lastCursor=null,a.vals=[],a.chartRef=null,a.state={startTime:v()(),endTime:v()(),current:!1,loggedIn:!1,graph:k,updating:!1,infoOn:!0,coordinates:[]},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=m.a.createElement("div",{className:"container"},m.a.createElement("div",{className:"notification is-info"},"Welcome! If it's your first time here, the toggle sets whether the data is updated live. Otherwise, you can grab specific data by selecting your time range, then pressing \"Update\". You may encounter errors if you're not authorized to access the datastore. You can close this message on the top right.",m.a.createElement("button",{onClick:this.infoHide,className:"delete"})));return this.state.loggedIn?m.a.createElement("div",null,this.state.infoOn?e:void 0,m.a.createElement("div",{className:"container notification"},m.a.createElement("div",{className:"columns"},m.a.createElement("div",{className:"column is-narrow"},m.a.createElement(D,{startVal:this.state.startTime,endVal:this.state.endTime,onChangeStart:this.handleChangeStart,onChangeEnd:this.handleChangeEnd})),m.a.createElement("div",{className:"column"},m.a.createElement("div",{className:"columns is-mobile"},m.a.createElement("div",{className:"toggle column is-narrow"},m.a.createElement(C.a,{defaultChecked:this.state.current,onChange:this.handleCurrent})),m.a.createElement("div",{className:"column is-narrow"},this.buttonProvider()))))),m.a.createElement("div",{className:"container notification has-background-white-bis"},m.a.createElement(H,{data:this.state.graph,chartRef:this.getChartRef})),m.a.createElement("div",{className:"container notification has-background-white-bis"},m.a.createElement(R,{coordinates:this.state.coordinates}))):m.a.createElement("div",null,m.a.createElement("div",{className:"container notification is-link floater"},"To get started, log in to generate an OAuth token."),m.a.createElement("div",{className:"login"},m.a.createElement(O.a,{clientId:"617338661646-v92ol8vhd4nl44vpntkv4jpjbq5hahmo.apps.googleusercontent.com",buttonText:"Login",onSuccess:this.responseGoogle,onFailure:this.responseFail})))}}]),t}(m.a.Component)),H=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).shouldComponentUpdate=function(e){return a.props.data!==e.data},a.render=function(){return console.log("Rerendering graph"),m.a.createElement("div",null,m.a.createElement(f.a,{data:a.props.data,options:S,ref:function(e){return a.props.chartRef(e)}}))},a}return Object(p.a)(t,e),t}(m.a.Component),R=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(c.a)(this,Object(d.a)(t).call(this,e))).shouldComponentUpdate=function(e){return a.props.coordinates!==e.coordinates},a.initMap=function(){var e=new window.google.maps.Map(document.getElementById("map"),{center:{lat:49.267941,lng:-123.24736},zoom:12});a.setState({map:e,loaded:!0})},a.drawLineOnMap=function(){a.props.coordinates.length>0?(console.log("Drawing lines"),a.state.map.panTo(new window.google.maps.LatLng(a.props.coordinates[Math.floor(a.props.coordinates.length/2)].lat,a.props.coordinates[Math.floor(a.props.coordinates.length/2)].lng)),null===a.lines?a.lines=new window.google.maps.Polyline({path:a.props.coordinates,map:a.state.map}):(a.lines.setMap(a.state.map),a.lines.setPath(a.props.coordinates))):null!==a.lines&&a.lines.setMap(null)},a.componentWillMount=function(){window.initMap=a.initMap;var e=document.createElement("script");e.async=!0,e.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCwcnq2MMCPKEY3hQigIBJn70buQH9py3E&callback=initMap",document.body.appendChild(e)},a.render=function(){return console.log("Rerendering map"),a.state.loaded&&a.drawLineOnMap(),m.a.createElement("div",{id:"map"})},a.lines=null,a.state={map:null,loaded:!1},a}return Object(p.a)(t,e),t}(m.a.Component),D=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return m.a.createElement("div",{className:"columns"},m.a.createElement("div",{className:"column"},m.a.createElement(y.DatetimePickerTrigger,{className:"input is-rounded is-small",shortcuts:j,moment:this.props.startVal,onChange:this.props.onChangeStart},m.a.createElement("input",{type:"text",value:this.props.startVal.format("YYYY-MM-DD HH:mm"),readOnly:!0}))),m.a.createElement("div",{className:"column"},m.a.createElement(y.DatetimePickerTrigger,{className:"input is-rounded is-small",shortcuts:j,moment:this.props.endVal,onChange:this.props.onChangeEnd,disabled:null===this.props.endVal},m.a.createElement("input",{type:"text",value:null===this.props.endVal?"Current":this.props.endVal.format("YYYY-MM-DD HH:mm"),readOnly:!0,disabled:null===this.props.endVal}))))}}]),t}(m.a.Component);g.a.render(m.a.createElement(T,null),document.getElementById("root"))},74:function(e,t,a){e.exports=a(243)}},[[74,1,2]]]);
//# sourceMappingURL=main.47916057.chunk.js.map