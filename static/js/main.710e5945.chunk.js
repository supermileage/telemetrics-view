(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{240:function(t,e,n){},241:function(t,e,n){},242:function(t,e,n){},74:function(t,e,n){t.exports=n(75)},75:function(t,e,n){"use strict";n.r(e);var a=n(73),r=n(42),o=n.n(r),s=n(68),i=n(28),l=n(43),u=n(30),c=n(29),p=n(31),d=n(0),h=n.n(d),m=n(41),g=n.n(m),b=n(69),f=n(4),v=n.n(f),y=n(44),E=n(71),C=n.n(E),O=n(72),T=n.n(O),S=(n(240),n(241),n(242),{datasets:[{showLine:!0,label:"Datapoints",fill:!0,lineTension:.1,backgroundColor:"rgba(75,192,192,0.4)",borderColor:"rgba(75,192,192,1)",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:"rgba(75,192,192,1)",pointBackgroundColor:"#fff",pointBorderWidth:1,pointHoverRadius:5,pointHoverBackgroundColor:"rgba(75,192,192,1)",pointHoverBorderColor:"rgba(220,220,220,1)",pointHoverBorderWidth:2,pointRadius:1,pointHitRadius:10,data:[]}]}),j=function(t){return t.current?{query:{filter:{propertyFilter:{op:"GREATER_THAN_OR_EQUAL",property:{name:"published_at"},value:{stringValue:t.startTime.toISOString()}}},kind:[{name:"ParticleEvent"}],projection:[{property:{name:"data"}},{property:{name:"published_at"}}]}}:{query:{filter:{compositeFilter:{filters:[{propertyFilter:{op:"GREATER_THAN_OR_EQUAL",property:{name:"published_at"},value:{stringValue:t.startTime.toISOString()}}},{propertyFilter:{op:"LESS_THAN_OR_EQUAL",property:{name:"published_at"},value:{stringValue:t.endTime.toISOString()}}}],op:"AND"}},kind:[{name:"ParticleEvent"}],projection:[{property:{name:"data"}},{property:{name:"published_at"}}]}}},k={Today:v()(),Yesterday:v()().subtract(1,"days")},H=function(t){function e(t){var n;return Object(i.a)(this,e),(n=Object(u.a)(this,Object(c.a)(e).call(this,t))).handleChangeStart=function(t){n.setState({startTime:t})},n.handleChangeEnd=function(t){n.setState({endTime:t})},n.handleCurrent=function(t){t.target.checked?(n.setState({current:!0,endTime:null}),n.intervalHandler()):(clearTimeout(n.timeout),n.setState({current:!1}),n.handleChangeEnd(v()()))},n.intervalHandler=function(){n.getData().then(function(){n.state.current&&(n.timeout=setTimeout(n.intervalHandler,2e3))})},n.getDataHandler=Object(s.a)(o.a.mark(function t(){var e;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=j(n.state),null!==n.lastCursor&&(e.query.startCursor=n.lastCursor),t.next=4,fetch("https://datastore.googleapis.com/v1/projects/ubc-supermileage-telemetry-v2:runQuery?prettyPrint=true&alt=json",{method:"POST",headers:{Authorization:"Bearer "+n.token,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).then(function(t){return t.json().then(function(t){console.log(t);try{if("entityResults"in t.batch?(console.log(),null===n.lastCursor?n.vals=[]:n.vals=n.vals.slice(),t.batch.entityResults.forEach(function(t){var e={};e.y=parseFloat(t.entity.properties.data.stringValue),e.x=v()(t.entity.properties.published_at.stringValue).unix()-n.state.startTime.unix(),e.t=v()(t.entity.properties.published_at.stringValue),n.vals.push(e)})):n.vals=[],"NOT_FINISHED"===t.batch.moreResults)return console.log("Not done"),n.lastCursor=t.batch.endCursor,n.getDataHandler()}catch(e){console.log(e)}return console.log("Done"),n.lastCursor=null,!0})});case 4:case"end":return t.stop()}},t,this)})),n.getData=function(){return n.setState({updating:!0}),new Promise(function(t){n.getDataHandler().then(function(){var e=Object(a.a)({},n.state.graph.datasets[0],{data:n.vals});n.setState({graph:{datasets:[e]},updating:!1}),t()})})},n.responseGoogle=function(t){n.setState({loggedIn:!0}),console.log(t),console.log("Success"),n.token=t.accessToken},n.responseFail=function(t){console.log(t),console.log("Failed")},n.buttonAction=function(){n.state.updating||(console.log("Button press registered"),n.getData())},n.buttonInit=function(){return h.a.createElement("span",{className:"updateButton"},h.a.createElement("button",{onClick:n.buttonAction},"Update"))},n.lastCursor=null,n.vals=[],n.state={startTime:v()(),endTime:v()(),current:!1,loggedIn:!1,graph:S,animations:!0,updating:!1},n}return Object(p.a)(e,t),Object(l.a)(e,[{key:"render",value:function(){return this.state.loggedIn?h.a.createElement("div",null,h.a.createElement("div",{className:"header"},h.a.createElement(_,{startVal:this.state.startTime,endVal:this.state.endTime,onChangeStart:this.handleChangeStart,onChangeEnd:this.handleChangeEnd}),h.a.createElement("label",{className:"toggle"},h.a.createElement(C.a,{defaultChecked:this.state.current,onChange:this.handleCurrent})),this.state.current?"":this.buttonInit(),this.state.updating?h.a.createElement("div",{className:"updating"},"Updating.."):""),h.a.createElement(D,{data:this.state.graph,animations:this.state.animations})):h.a.createElement("div",{className:"login"},h.a.createElement(T.a,{clientId:"617338661646-v92ol8vhd4nl44vpntkv4jpjbq5hahmo.apps.googleusercontent.com",buttonText:"Login",onSuccess:this.responseGoogle,onFailure:this.responseFail}))}}]),e}(h.a.Component),D=function(t){function e(){var t,n;Object(i.a)(this,e);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(t=Object(c.a)(e)).call.apply(t,[this].concat(r)))).render=function(){return h.a.createElement("div",null,h.a.createElement(b.a,{data:n.props.data,options:{animation:!!n.props.animations&&{duration:500},scales:{xAxes:[{type:"time",time:{unit:"second"}}]}}}))},n}return Object(p.a)(e,t),e}(h.a.Component),_=function(t){function e(){return Object(i.a)(this,e),Object(u.a)(this,Object(c.a)(e).apply(this,arguments))}return Object(p.a)(e,t),Object(l.a)(e,[{key:"render",value:function(){return h.a.createElement("div",{className:"pickers"},h.a.createElement(y.DatetimePickerTrigger,{shortcuts:k,moment:this.props.startVal,onChange:this.props.onChangeStart},h.a.createElement("input",{type:"text",value:this.props.startVal.format("YYYY-MM-DD HH:mm"),readOnly:!0}))," - ",h.a.createElement(y.DatetimePickerTrigger,{shortcuts:k,moment:this.props.endVal,onChange:this.props.onChangeEnd,disabled:null===this.props.endVal},h.a.createElement("input",{type:"text",value:null===this.props.endVal?"Current":this.props.endVal.format("YYYY-MM-DD HH:mm"),readOnly:!0,disabled:null===this.props.endVal})))}}]),e}(h.a.Component);g.a.render(h.a.createElement(H,null),document.getElementById("root"))}},[[74,1,2]]]);
//# sourceMappingURL=main.710e5945.chunk.js.map