(this["webpackJsonptelemetry-web"]=this["webpackJsonptelemetry-web"]||[]).push([[0],{248:function(e,t,a){e.exports=a(404)},404:function(e,t,a){"use strict";a.r(t);var n=a(35),r=a(37),o=a(38),s=a(39),i=a(51),l=a.n(i),c=function(e,t,a){return{datasets:[{spanGaps:!1,showLine:!0,label:e,yAxisID:t,fill:!0,lineTension:.1,backgroundColor:"rgba(75,192,192,0.4)",borderColor:"rgba(75,192,192,1)",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:"rgba(75,192,192,1)",pointBackgroundColor:"#fff",pointBorderWidth:1,pointHoverRadius:5,pointHoverBackgroundColor:"rgba(75,192,192,1)",pointHoverBorderColor:"rgba(220,220,220,1)",pointHoverBorderWidth:2,pointRadius:1,pointHitRadius:10,data:a}]}},p=a(0),u=a.n(p),d=a(207),m=function(e){function t(){var e,a;Object(n.a)(this,t);for(var s=arguments.length,i=new Array(s),l=0;l<s;l++)i[l]=arguments[l];return(a=Object(r.a)(this,(e=Object(o.a)(t)).call.apply(e,[this].concat(i)))).render=function(){return u.a.createElement(p.Fragment,null,u.a.createElement(d.a,{data:a.props.data,options:a.props.options}))},a}return Object(s.a)(t,e),t}(u.a.Component),f=a(461),h=a(6),g=(a(390),a(459)),y=a(215),b=a(472),v=a(442),E=a(466),x=a(460),O=a(12),w=a(473),C=a(209),S=a(173),k=a(127),j=a(462),T=a(464),F=a(160),H=a(203),I=a(204),L=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(o.a)(t).call(this,e))).clearFeature=function(e){a.features[e]&&a.features[e].getSource().getFeatures().forEach((function(t){return a.features[e].getSource().removeFeature(t)}))},a.formatCoordinate=function(e){return O.d([e.lng,e.lat])},a.componentDidMount=function(){var e=new g.a({view:new y.a({center:a.formatCoordinate(A.map.defaults.center),zoom:A.map.defaults.zoom}),layers:[new E.a({source:new j.a})],controls:F.a().extend([new H.a,new I.a]),target:"map"});a.setState({map:e,loaded:!0},a.bootstrapOverlay)},a.shouldComponentUpdate=function(e,t){return!a.props.data||(a.state.loaded!==t.loaded||(!e.data||a.props.data.length!==e.data.length||JSON.stringify(a.props.data)!==JSON.stringify(e.data)))},a.componentWillUnmount=function(){a.features={},a.setState({map:null,loaded:!1})},a.bootstrapOverlay=function(){a.features.overlay=new b.a({element:document.getElementById("popup"),autoPan:!0,autoPanAnimation:{duration:250}}),a.state.map.addOverlay(a.features.overlay),a.state.map.on("pointermove",(function(e){if(!0===a.state.map.hasFeatureAtPixel(e.pixel)){var t=a.state.map.getFeaturesAtPixel(e.pixel);t.length<5&&t.forEach((function(t){"point"===t.get("name")&&(document.getElementById("popup-content").innerHTML="<b>".concat(l()(t.get("timestamp")).format("HH:mm:ss A"),"</b>"),a.features.overlay.setPosition(e.coordinate))}))}else a.features.overlay.setPosition(void 0)}))},a.centerMap=function(){a.props.data&&a.props.data.length>0&&a.state.map.getView().setCenter(a.formatCoordinate(a.props.data[a.props.data.length-1]))},a.drawLineOnMap=function(){if(a.props.data&&a.props.data.length>0){a.features.lines&&a.clearFeature("lines");var e=new v.a({geometry:new w.a(a.props.data.map((function(e){return a.formatCoordinate(e)}))),name:"lines"});a.features.lines=new x.a({source:new T.a({features:[e]})}),e.setStyle(new S.b({stroke:new k.a({width:4})})),a.state.map.addLayer(a.features.lines)}else a.clearFeature("lines")},a.drawMarkersOnMap=function(){if(a.props.data&&a.props.data.length>0){a.features.markers&&a.clearFeature("markers");var e=[];a.props.data.forEach((function(t){e.push(new v.a({geometry:new C.a(a.formatCoordinate(t)),name:"point",timestamp:t.timestamp}))})),a.features.markers=new x.a({source:new T.a({features:e})}),a.state.map.addLayer(a.features.markers)}else a.clearFeature("markers")},a.render=function(){var e=a.props.classes;return a.state.loaded&&(a.drawLineOnMap(),a.drawMarkersOnMap(),a.centerMap()),u.a.createElement(f.a,{id:"map",className:e.map},u.a.createElement("div",{id:"popup",className:e.popup},u.a.createElement("div",{id:"popup-content"})))},a.features={},a.state={map:null,loaded:!1},a}return Object(s.a)(t,e),t}(u.a.Component),M=Object(h.a)({map:{height:"80vh"},popup:{backgroundColor:"white",border:"1px solid white",borderRadius:"8px"}})(L),A={datastore:{projectId:"supermileage-telemetry-266511",getQueryUrl:function(){return"https://datastore.googleapis.com/v1/projects/"+this.projectId+":runQuery?alt=json"},generatePayload:function(e,t){return{method:"POST",headers:{Authorization:"Bearer "+e,Accept:"application/json","Content-Type":"application/json"},body:t}},datasets:{Urban:[{label:"Temperature",id:"Temperature",handler:function(e,t){var a=t.entity.properties.data.stringValue.split(" "),n={};n.y=parseFloat(a[0]),n.x=l()(t.entity.properties.recorded_at.stringValue),e.length>0&&n.x.unix()-l()(e[e.length-1].x).unix()>600&&e.push({y:NaN,x:n.x}),e.push(n)},parser:function(e,t,a){return c(e,t,a)},element:function(e){return u.a.createElement(m,{key:this.id,data:e||{},options:this.options})},options:{animation:{duration:500},scales:{xAxes:[{gridLines:{display:!1},type:"time",distribution:"linear",scaleLabel:{display:!0,labelString:"Time"}}],yAxes:[{id:"Temperature",position:"left",gridLines:{display:!1},scaleLabel:{display:!0,labelString:"Temperature (C)"}}]}}},{label:"Power",id:"Power",handler:function(e,t){var a={};a.y=parseFloat(t.entity.properties.data.stringValue),a.x=l()(t.entity.properties.recorded_at.stringValue),e.length>0&&a.x.unix()-l()(e[e.length-1].x).unix()>600&&e.push({y:NaN,x:a.x}),e.push(a)},parser:function(e,t,a){return c(e,t,a)},element:function(e){return u.a.createElement(m,{key:this.id,data:e||{},options:this.options})},options:{animation:{duration:500},scales:{xAxes:[{gridLines:{display:!1},type:"time",distribution:"linear",scaleLabel:{display:!0,labelString:"Time"}}],yAxes:[{id:"Power",position:"left",gridLines:{display:!1},scaleLabel:{display:!0,labelString:"State of Charge (%)"}}]}}},{label:"Location",id:"Location",handler:function(e,t){var a=t.entity.properties.data.stringValue.split(","),n=parseInt(parseInt(a[3])/100)+parseFloat(parseFloat(a[3])%100)/60,r=parseInt(parseInt(a[5])/100)+parseFloat(parseFloat(a[5])%100)/60,o={lat:n="S"===a[4]?-n:n,lng:r="W"===a[6]?-r:r};e.push(o)},parser:function(e,t,a){return a},element:function(e){return u.a.createElement(M,{key:this.id,data:e||[]})}}],Proto:[{label:"Speed",id:"PROTO-Speed",handler:function(e,t){var a=t.entity.properties.data.stringValue.split(","),n={};n.y=parseFloat(a[a.indexOf("K")-1]),n.x=l()(t.entity.properties.recorded_at.stringValue),e.length>0&&n.x.unix()-l()(e[e.length-1].x).unix()>600&&e.push({y:NaN,x:n.x}),e.push(n)},parser:function(e,t,a){return c(e,t,a)},element:function(e){return u.a.createElement(m,{key:this.id,data:e||{},options:this.options})},options:{animation:{duration:500},scales:{xAxes:[{gridLines:{display:!1},type:"time",distribution:"linear",scaleLabel:{display:!0,labelString:"Time"}}],yAxes:[{id:"PROTO-Speed",position:"left",gridLines:{display:!1},scaleLabel:{display:!0,labelString:"km/h"}}]}}},{label:"Location",id:"PROTO-Location",handler:function(e,t){var a=t.entity.properties.data.stringValue.split(","),n=parseInt(parseInt(a[3])/100)+parseFloat(parseFloat(a[3])%100)/60,r=parseInt(parseInt(a[5])/100)+parseFloat(parseFloat(a[5])%100)/60,o={lat:n="S"===a[4]?-n:n,lng:r="W"===a[6]?-r:r,timestamp:t.entity.properties.recorded_at.stringValue};e.push(o)},parser:function(e,t,a){return a},element:function(e){return u.a.createElement(M,{key:this.id,data:e||[]})}}]}},oauth:{clientId:"929098184548-qq0n3oj40b7s2qbk8nmjm9cn5c6bs15l.apps.googleusercontent.com"},map:{defaults:{center:{lat:49.267941,lng:-123.24736},zoom:12}},refreshInterval:5e3},N=a(210),P=a.n(N),_=a(71),D=a.n(_),R=a(446),V=function(e){function t(){var e,a;Object(n.a)(this,t);for(var s=arguments.length,i=new Array(s),l=0;l<s;l++)i[l]=arguments[l];return(a=Object(r.a)(this,(e=Object(o.a)(t)).call.apply(e,[this].concat(i)))).render=function(){var e=a.props.classes;return u.a.createElement(R.a,{className:e.button,variant:"contained",color:"primary",disabled:a.props.updating||a.props.liveMode,onClick:a.props.getDataHandler},a.props.liveMode?"Live":"Update")},a}return Object(s.a)(t,e),t}(u.a.Component),U=Object(h.a)({button:{minWidth:90}})(V),B=a(467),W=a(216),Q=a(211),q=a.n(Q),J=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(o.a)(t).call(this,e))).closeHelp=function(){a.setState({helpOpen:!1})},a.openHelp=function(){a.setState({helpOpen:!0})},a.render=function(){return u.a.createElement(p.Fragment,null,u.a.createElement(B.a,{anchorOrigin:{vertical:"top",horizontal:"center"},open:a.state.helpOpen,message:"The start and stop time determine your data time range.  The toggle controls whether you'll update the data, live. If you're  getting errors, check if you have permissions to view the datastore,  or refresh the page. You can expand the panel to select which graphs  to show.",action:u.a.createElement(R.a,{variant:"contained",color:"secondary",onClick:a.closeHelp},"Okay"),onClose:a.closeHelp}),u.a.createElement(W.a,{onClick:a.openHelp},u.a.createElement(q.a,null)))},a.state={helpOpen:!1},a}return Object(s.a)(t,e),t}(u.a.Component),z=a(44),G=a(458),Y=a(447),K=a(212),X=function(e){function t(){var e,a;Object(n.a)(this,t);for(var s=arguments.length,i=new Array(s),l=0;l<s;l++)i[l]=arguments[l];return(a=Object(r.a)(this,(e=Object(o.a)(t)).call.apply(e,[this].concat(i)))).render=function(){return u.a.createElement(z.a,{utils:K.a},u.a.createElement(Y.a,{container:!0,spacing:2,alignItems:"center",justify:"center"},u.a.createElement(Y.a,{item:!0,xs:12,sm:6},u.a.createElement(G.a,{fullWidth:!0,label:"Start time",format:"MMM D, hh:mm a",onChange:a.props.onChangeStart,value:a.props.startTime})),u.a.createElement(Y.a,{item:!0,xs:12,sm:6},u.a.createElement(G.a,{fullWidth:!0,label:"End time",format:"MMM D, hh:mm a",onChange:a.props.onChangeEnd,value:a.props.endTime,emptyLabel:"current",disabled:null===a.props.endTime}))))},a}return Object(s.a)(t,e),t}(u.a.Component),Z=a(471),$=a(452),ee=a(465),te=a(407),ae=a(453),ne=a(468),re=a(454),oe=a(450),se=a(470),ie=a(463),le=a(455),ce=a(456),pe=a(406),ue=a(214),de=a.n(ue),me=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(o.a)(t).call(this,e))).startTimeChangeHandler=function(e){a.setState({startTime:e})},a.endTimeChangeHandler=function(e){a.setState({endTime:e})},a.liveUpdateHandler=function(e){e.target.checked?(a.setState({liveMode:!0,endTime:null}),a.intervalHandler()):(clearTimeout(a.timeout),a.setState({liveMode:!1}),a.endTimeChangeHandler(l()()))},a.intervalHandler=function(){return D.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.a.awrap(a.updateMetrics());case 2:a.state.liveMode&&(a.timeout=setTimeout(a.intervalHandler,A.refreshInterval));case 3:case"end":return e.stop()}}))},a.getDataHandler=function(e,t,n,r){var o,s,i;return D.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:return c=a.state.liveMode,p=a.state.startTime,u=a.state.endTime,d=n,o=c?{query:{filter:{compositeFilter:{filters:[{propertyFilter:{op:"GREATER_THAN_OR_EQUAL",property:{name:"recorded_at"},value:{stringValue:p.toISOString()}}},{propertyFilter:{op:"EQUAL",property:{name:"event"},value:{stringValue:d}}}],op:"AND"}},kind:[{name:"ParticleEvent"}],projection:[{property:{name:"data"}},{property:{name:"recorded_at"}}]}}:{query:{filter:{compositeFilter:{filters:[{propertyFilter:{op:"GREATER_THAN_OR_EQUAL",property:{name:"recorded_at"},value:{stringValue:p.toISOString()}}},{propertyFilter:{op:"LESS_THAN_OR_EQUAL",property:{name:"recorded_at"},value:{stringValue:u.toISOString()}}},{propertyFilter:{op:"EQUAL",property:{name:"event"},value:{stringValue:d}}}],op:"AND"}},kind:[{name:"ParticleEvent"}],projection:[{property:{name:"data"}},{property:{name:"recorded_at"}}]}},null!==e&&(o.query.startCursor=e),l.next=4,D.a.awrap(fetch(A.datastore.getQueryUrl(),A.datastore.generatePayload(a.props.token,JSON.stringify(o))));case 4:return s=l.sent,l.next=7,D.a.awrap(s.json());case 7:if(i=l.sent,l.prev=8,"entityResults"in i.batch&&i.batch.entityResults.forEach((function(e){r(t,e)})),"NOT_FINISHED"!==i.batch.moreResults){l.next=14;break}return l.next=13,D.a.awrap(a.getDataHandler(i.batch.endCursor,t,n,r));case 13:return l.abrupt("return",l.sent);case 14:l.next=19;break;case 16:l.prev=16,l.t0=l.catch(8),console.log(l.t0);case 19:return l.abrupt("return",t);case 20:case"end":return l.stop()}var c,p,u,d}),null,null,[[8,16]])},a.getData=function(){var e,t,n,r,o,s,i,l;return D.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:if(e={},!a.state.car){c.next=31;break}t=!0,n=!1,r=void 0,c.prev=5,o=A.datastore.datasets[a.state.car][Symbol.iterator]();case 7:if(t=(s=o.next()).done){c.next=17;break}if(i=s.value,!a.state.datasets.includes(i.label)){c.next=14;break}return c.next=12,D.a.awrap(a.getDataHandler(null,[],i.id,i.handler));case 12:l=c.sent,e[i.id]=i.parser(i.label,i.id,l);case 14:t=!0,c.next=7;break;case 17:c.next=23;break;case 19:c.prev=19,c.t0=c.catch(5),n=!0,r=c.t0;case 23:c.prev=23,c.prev=24,t||null==o.return||o.return();case 26:if(c.prev=26,!n){c.next=29;break}throw r;case 29:return c.finish(26);case 30:return c.finish(23);case 31:return c.abrupt("return",e);case 32:case"end":return c.stop()}}),null,null,[[5,19,23,31],[24,,26,30]])},a.updateMetrics=function(){var e;return D.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return a.setState({updating:!0}),t.next=3,D.a.awrap(a.getData());case 3:e=t.sent,a.setState({updating:!1,data:e});case 5:case"end":return t.stop()}}))},a.changeCar=function(e){e.target.value!==a.state.car&&a.setState({car:e.target.value,data:{},datasets:A.datastore.datasets[e.target.value].map((function(e){return e.label}))})},a.populateCars=function(){var e=[];for(var t in A.datastore.datasets)e.push(u.a.createElement(Z.a,{value:t,key:t},t));return e},a.modifyDatasets=function(e){e.target.checked?(a.state.datasets.push(e.target.value),a.setState({datasets:a.state.datasets.slice()})):a.setState({datasets:a.state.datasets.filter((function(t){return t!==e.target.value}))})},a.getCarProperties=function(){return a.state.car?A.datastore.datasets[a.state.car].map((function(e){return u.a.createElement(Y.a,{item:!0,key:e.label},u.a.createElement($.a,{control:u.a.createElement(ee.a,{onChange:a.modifyDatasets,value:e.label,checked:a.state.datasets.includes(e.label)}),label:e.label}))})):u.a.createElement(te.a,null,"You have to select a car first!")},a.render=function(){var e=a.props.classes;return u.a.createElement(p.Fragment,null,u.a.createElement(ae.a,{className:e.container},u.a.createElement(ne.a,null,u.a.createElement(re.a,{expandIcon:u.a.createElement(de.a,null)},u.a.createElement(oe.a,{onClick:function(e){return e.stopPropagation()},onFocus:function(e){return e.stopPropagation()}},u.a.createElement(Y.a,{container:!0,spacing:1,alignItems:"center",justify:"center"},u.a.createElement(Y.a,{item:!0},u.a.createElement(X,{startTime:a.state.startTime,endTime:a.state.endTime,onChangeStart:a.startTimeChangeHandler,onChangeEnd:a.endTimeChangeHandler})),u.a.createElement(Y.a,{item:!0},u.a.createElement(Y.a,{container:!0,spacing:1,alignItems:"center"},u.a.createElement(Y.a,{item:!0,xs:12,sm:!0},u.a.createElement(oe.a,null,u.a.createElement(se.a,null,"Car"),u.a.createElement(ie.a,{className:e.select,label:"Car",value:a.state.car||"",onChange:a.changeCar},a.populateCars()))),u.a.createElement(Y.a,{item:!0,xs:3,sm:!0},u.a.createElement(le.a,{checked:a.state.liveMode,onChange:a.liveUpdateHandler})),u.a.createElement(Y.a,{item:!0,xs:5,sm:!0},u.a.createElement(U,{liveMode:a.state.liveMode,getDataHandler:a.updateMetrics,updating:a.state.updating})),u.a.createElement(Y.a,{item:!0,xs:4,sm:!0},u.a.createElement(J,null))))))),u.a.createElement(ce.a,null,u.a.createElement(Y.a,{container:!0,spacing:1,alignItems:"center",justify:"center"},a.getCarProperties())))),u.a.createElement(ae.a,{className:e.container},u.a.createElement(Y.a,{container:!0,spacing:2},a.state.car?A.datastore.datasets[a.state.car].filter((function(e){return a.state.datasets.includes(e.label)})).map((function(t,n){return u.a.createElement(Y.a,{item:!0,xs:12,key:n},u.a.createElement(pe.a,{className:e.paper},t.element(a.state.data[t.id])))})):void 0)))},a.state={startTime:l()(),endTime:l()(),liveMode:!1,updating:!1,dropdownOpen:!1,datasets:[],data:{},car:void 0},a}return Object(s.a)(t,e),t}(u.a.Component),fe=Object(h.a)((function(e){return{select:{minWidth:120},container:{padding:e.spacing(2)},paper:{padding:e.spacing(2)}}}))(me),he=a(457),ge=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(o.a)(t).call(this,e))).oauthSuccess=function(e){a.setState({loggedOn:!0,token:e.accessToken})},a.oauthFailure=function(e){console.log(e,"Oauth Failed.")},a.render=function(){var e=a.props.classes;return u.a.createElement(he.a,null,a.state.loggedOn?u.a.createElement(fe,{token:a.state.token}):u.a.createElement(ae.a,{maxWidth:"xs",className:e.root},u.a.createElement(Y.a,{container:!0,spacing:2,justify:"center",alignItems:"center"},u.a.createElement(Y.a,{container:!0,justify:"center"},u.a.createElement(Y.a,{item:!0},u.a.createElement(P.a,{clientId:A.oauth.clientId,scope:"profile email https://www.googleapis.com/auth/datastore",buttonText:"Login",onSuccess:a.oauthSuccess,onFailure:a.oauthFailure}))))))},a.state={loggedOn:!1,token:void 0},a}return Object(s.a)(t,e),t}(u.a.Component),ye=Object(h.a)({root:{paddingTop:200}})(ge),be=a(33);a.n(be).a.render(u.a.createElement(ye,null),document.getElementById("root"))}},[[248,1,2]]]);
//# sourceMappingURL=main.b0534213.chunk.js.map